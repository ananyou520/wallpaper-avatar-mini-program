!function() {
    function e(e, t, n) {
        return t in e ? Object.defineProperty(e, t, {
            value: n,
            enumerable: !0,
            configurable: !0,
            writable: !0
        }) : e[t] = n, e;
    }
    var t = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
        return typeof e;
    } : function(e) {
        return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e;
    }, n = "function" == typeof Symbol && "symbol" === t(Symbol.iterator) ? function(e) {
        return void 0 === e ? "undefined" : t(e);
    } : function(e) {
        return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : void 0 === e ? "undefined" : t(e);
    };
    !function(e, t) {
        "object" == ("undefined" == typeof exports ? "undefined" : n(exports)) && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define(t) : (void 0).app = t();
    }(0, function() {
        var n = require("./u8ad_conf.js"), a = require("./u8ad_md5.js"), o = {};
        n.app_key && 32 === n.app_key.length || console.warn("易速小程序联盟提示：配置错误，请在u8ad_conf.js中正确配置您的app_key。");
        var u = App, i = Page, r = {
            ak: n.app_key.replace(/(^\s*)|(\s*$)/g, ""),
            v: "2.14",
            debug: !!n.debug && n.debug,
            adtype: "",
            reqid: "",
            pb: "",
            pm: "",
            sv: "",
            pv: "",
            nt: "",
            ww: 0,
            wh: 0,
            ad_num: 1,
            pr: 0,
            long: 0,
            lat: 0,
            wvv: "",
            wv: "",
            lang: "",
            wsr: {},
            pp: "",
            uuid: "",
            user_info: {}
        }, c = 0, s = "", d = function(e, t, n) {
            if (e[t]) {
                var a = e[t];
                e[t] = function(e) {
                    a.call(this, e), n.call(this, e, t);
                };
            } else e[t] = function(e) {
                n.call(this, e, t);
            };
        }, f = function(e, n) {
            p(n, [ "ad" ], function(a) {
                if (0 == a.data.errcode) {
                    parseFloat(r.v) < parseFloat(a.data.version) && console.warn("发现v" + a.data.version + "版U8广告联盟SDK，当前版本v" + r.v + "，请尽快升级！");
                    var u = a.data.list, i = "object" == (void 0 === n ? "undefined" : t(n)) ? n[Object.keys(n)[0]] : [ n ];
                    for (var c in u) {
                        o[i[c]] = u[c], o[i[c]].hasshow = !0, o[i[c]].id = n, o[i[c]].push = 0, o[i[c]].encdata = {
                            encdata: o[i[c]].encdata
                        };
                        var s = e.data.u8ad;
                        s.adData = o, e.setData({
                            u8ad: s
                        });
                    }
                }
            });
        }, p = function(e, t, n, a) {
            0 === c ? function(e) {
                function t() {
                    2 === n.length && (c = 1, e && e());
                }
                var n = [];
                wx.getSetting({
                    success: function(e) {
                        e.authSetting["scope.userInfo"] ? wx.getUserInfo({
                            withCredentials: !1,
                            success: function(e) {
                                r.user_info = e.userInfo;
                            },
                            complete: function() {
                                n.push("ok1"), t();
                            }
                        }) : (n.push("ok1"), t());
                    },
                    fail: function() {
                        n.push("ok1"), t();
                    }
                }), wx.getSystemInfo({
                    success: function(e) {
                        r.wv = void 0 === e.SDKVersion ? "1.0.0" : e.SDKVersion, r.pb = e.brand, r.pm = e.model, 
                        r.pr = e.pixelRatio, r.ww = e.screenWidth, r.wh = e.screenHeight, r.lang = e.language, 
                        r.wvv = e.version, r.sv = e.system, r.pv = e.platform;
                    },
                    complete: function() {
                        n.push("ok2"), t();
                    }
                }), wx.getSetting({
                    success: function(e) {
                        e.authSetting["scope.userLocation"] ? wx.getLocation({
                            type: "wgs84",
                            success: function(e) {
                                r.long = e.latitude, r.lat = e.longitude;
                            },
                            complete: function() {
                                n.push("ok3"), t();
                            }
                        }) : (n.push("ok3"), t());
                    },
                    fail: function() {
                        n.push("ok3"), t();
                    }
                }), wx.getNetworkType({
                    success: function(e) {
                        r.nt = e.networkType;
                    },
                    complete: function() {
                        n.push("ok4"), t();
                    }
                });
            }(function() {
                l(e, n, t, a);
            }) : l(e, n, t, a);
        }, l = function(e, n, o, u) {
            u = u ? "get" : "post";
            if (r.adtype = "object" == (void 0 === e ? "undefined" : t(e)) ? Object.keys(e)[0] : e, 
            r.ad_num = "object" == (void 0 === e ? "undefined" : t(e)) ? e[Object.keys(e)[0]].length : 1, 
            r.uuid = r.uuid || i(), "log" != o[0]) {
                var c = Date.now() + r.ak + r.uuid + r.adtype;
                r.reqid = a.hexMD5(c), r.data_type = !0;
            }
            var s = 0;
            !function e() {
                wx.request({
                    url: "https://www.u8ad.com/api/" + o[0],
                    data: r,
                    header: {},
                    method: u,
                    success: function(e) {
                        n(e);
                    },
                    fail: function() {
                        2 > s && (s++, r.retryTimes = s, setTimeout(function() {
                            e();
                        }, 1e3));
                    }
                });
            }();
        }, g = function(e) {
            this.app = e;
        }, y = function(t) {
            this.u8ad = new g(this), g.prototype.getu8Ads = function(t, n) {
                for (var a = [], o = 0; o < t[Object.keys(t)[0]]; o++) a.push(o);
                p(e({}, Object.keys(t)[0], a), [ "ad" ], function(e) {
                    if (e.data.errcode) n({
                        code: 1,
                        errmsg: e.data.errmsg
                    }); else {
                        if (parseFloat(r.v) < parseFloat(e.data.version)) return console.warn("发现v" + e.data.version + "版U8广告联盟SDK，当前版本v" + r.v + "，请尽快升级！"), 
                        !1;
                        var t = [];
                        for (var a in e.data.list) {
                            var o, u = e.data.list[a];
                            o = {
                                appId: u.to_appid,
                                name: u.name,
                                desc: u.desc,
                                logo: u.pic,
                                img: u.to_qr,
                                load_page: u.load_page,
                                ckey: u.ckey,
                                adtype: u.adtype,
                                jump_type: u.jump_type,
                                encdata: u.encdata
                            }, t.push(o);
                        }
                        n({
                            code: 0,
                            data: t
                        });
                    }
                });
            }, g.prototype.u8AdsClk = function(e) {
                h(e);
            }, r.uuid = function() {
                function e() {
                    return Math.floor(65536 * (1 + Math.random())).toString(16).substring(1);
                }
                var t;
                try {
                    if (t = wx.getStorageSync("u8aduuid")) return t;
                } catch (e) {}
                t = e() + e() + e() + e() + e() + e() + e() + e();
                try {
                    wx.setStorageSync("u8aduuid", t);
                } catch (e) {}
                return t;
            }(), v(t);
        }, h = function(e) {
            m(e, "cli", function() {}, "get");
        }, v = function(e) {
            s = 1048 == e.scene || 1047 == e.scene ? e.query.encdata : 1037 == e.scene ? e.referrerInfo.extraData.encdata : "";
            var t = null;
            wx.getSystemInfo({
                success: function(e) {
                    t = e;
                }
            }), wx.login({
                success: function(e) {
                    encodeURIComponent(e.code), r.uuid, r.ak, t.brand, t.model, t.pixelRatio, t.screenWidth, 
                    t.screenHeight, t.language, t.version, t.system, t.platform;
                },
                fail: function() {}
            }), function e(t) {
                wx.getSetting({
                    success: function(n) {
                        n.authSetting["scope.userInfo"] || setTimeout(function() {
                            wx.getSetting({
                                success: function(n) {
                                    if (n.authSetting["scope.userInfo"]) {
                                        var o = Date.parse(new Date()) / 1e3, u = a.hexMD5(r.ak + r.uuid + o);
                                        wx.getUserInfo({
                                            success: function(e) {
                                                if (!s) return !1;
                                                wx.request({
                                                    url: "https://www.u8ad.com/api/auth",
                                                    method: "POST",
                                                    data: {
                                                        d_key: u,
                                                        time: o,
                                                        encdata: s,
                                                        uuid: r.uuid,
                                                        ak: r.ak,
                                                        user_info: e.userInfo
                                                    },
                                                    success: function() {}
                                                });
                                            }
                                        });
                                    } else e(t);
                                }
                            });
                        }, 6e3);
                    }
                });
            }(e);
        }, m = function(e, t) {
            var n = n ? "get" : "post", a = {
                key: e
            }, o = 0;
            !function e() {
                wx.request({
                    url: "https://www.u8ad.com/api/" + t,
                    data: a,
                    method: n ? "post" : "get",
                    success: function() {},
                    fail: function() {
                        2 > o && (o++, a.retryTimes = o, setTimeout(function() {
                            e();
                        }, 1e3));
                    }
                });
            }();
        }, w = function(e) {
            var t = e.currentTarget.dataset.id, n = o[t];
            if (0 === n.push && (n.ikey, 1 === n.adtype)) {
                var a = this, u = wx.createIntersectionObserver(a, {
                    thresholds: [ .2 ],
                    selectAll: !0
                });
                u.relativeToViewport().observe(".u8_banner", function(e) {
                    if (.2 < e.intersectionRatio) {
                        var n = a.data.u8ad;
                        n.adData[t].push = 1, a.setData({
                            u8ad: n
                        }), u.disconnect();
                    }
                });
            }
        }, b = function(e) {
            var t = e.currentTarget.dataset.id, n = this.data.u8ad;
            n.adData[t].hasshow = !1, this.setData({
                u8ad: n
            });
        }, k = function(e) {
            var t = e.currentTarget.dataset.id, n = o[t].ckey, a = o[t].jump_type;
            switch (a) {
              case 1:
                e.currentTarget.dataset.adImgUrl || (e.currentTarget.dataset.adImgUrl = o[t].to_qr), 
                wx.previewImage({
                    current: e.currentTarget.dataset.adImgUrl,
                    urls: [ e.currentTarget.dataset.adImgUrl ],
                    success: function() {
                        m(n, "cli", function() {}, "get");
                    }
                });
                break;

              case 2:
                m(n, "cli", function() {}, "get");
                break;

              default:
                console.error("SDK错误：跳转类型为：" + a + " ，不是约定的类型。无法进行跳转、点击上报，联系工程师！！！");
            }
        }, S = function() {
            var n;
            r.wsr = wx.getStorageSync("u8wsr"), r.pp = this.route;
            try {
                n = this.data.u8ad.ad;
            } catch (n) {}
            if (n) {
                for (var a in n) n[a] && ("object" == t(n[a]) ? f(this, e({}, a, n[a])) : f(this, a));
            }
        }, x = function() {
            var e = this.options.u8adH5url;
            e && (e = e.replace("|", "?").replace("$", "="), this.setData({
                u8adURL: e
            }));
        };
        App = function(e) {
            d(e, "onLaunch", y), u(e);
        }, Page = function(e) {
            d(e, "onLoad", S), d(e, "onShow", x), d(e, "u8adClose", b), d(e, "u8adLoad", w), 
            d(e, "u8adClick", k), i(e);
        };
    });
}();